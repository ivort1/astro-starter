---
import { FAQS, SITE } from "../../data/site";
import IconPhone from "../ui/IconPhone.astro";
import IconArrow from "../ui/IconArrow.astro";
---

<section class="py-24 px-6">
  <div class="max-w-[720px] mx-auto">
    {FAQS.map((faq, i) => (
      <div class="border-b border-gray-100 faq-item">
        <button
          class="w-full py-6 bg-transparent border-none flex justify-between items-center cursor-pointer text-base font-semibold text-left transition-colors duration-200 hover:text-accent faq-trigger"
          style={`font-family: var(--font-body); color: var(--color-black);`}
          aria-expanded="false"
          data-faq={i}
        >
          {faq.q}
          <svg class="faq-chevron shrink-0 ml-4" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9" />
          </svg>
        </button>
        <div
          class="text-[15px] text-gray-700 leading-relaxed pb-6 hidden faq-answer"
          data-faq-answer={i}
        >
          {faq.a}
        </div>
      </div>
    ))}
  </div>

  <!-- Bottom CTA -->
  <div class="text-center mt-14 max-w-[720px] mx-auto">
    <p class="text-[17px] text-gray-700 mb-6">Still have questions? We'd love to hear from you.</p>
    <div class="flex gap-4 justify-center flex-wrap">
      <a href={SITE.phoneTel} class="btn-primary">
        <IconPhone /> Call {SITE.phoneFmt}
      </a>
      <a href="/contact" class="btn-outline">
        Send Us a Message <IconArrow />
      </a>
    </div>
  </div>
</section>

<script>
  document.querySelectorAll(".faq-trigger").forEach((btn) => {
    btn.addEventListener("click", () => {
      const i = btn.getAttribute("data-faq");
      const answer = document.querySelector(`[data-faq-answer="${i}"]`);
      const chevron = btn.querySelector(".faq-chevron");
      const isOpen = !answer?.classList.contains("hidden");

      // Close all others
      document.querySelectorAll(".faq-answer").forEach((a) => a.classList.add("hidden"));
      document.querySelectorAll(".faq-chevron").forEach((c) => c.classList.remove("open"));
      document.querySelectorAll(".faq-trigger").forEach((t) => t.setAttribute("aria-expanded", "false"));

      if (!isOpen && answer) {
        answer.classList.remove("hidden");
        chevron?.classList.add("open");
        btn.setAttribute("aria-expanded", "true");
      }
    });
  });
</script>
