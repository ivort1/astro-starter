---
import {SITE, NAV_LINKS } from "../data/site";

const phoneClean = SITE.phoneTel;
const phoneFormatted = SITE.phoneFmt;

const currentPath = Astro.url.pathname;
---

<nav class="fixed top-0 left-0 right-0 z-100 bg-white border-b border-neutral-200" id="nav" role="navigation" aria-label="Main navigation">
  <div class="flex items-center justify-between max-w-400 mx-auto py-3.5 px-4 lg:py-4 lg:px-8">
    <!-- Logo -->
    <a href="/" class="text-lg font-bold text-neutral-900 no-underline whitespace-nowrap sm:text-xl lg:text-[1.375rem]">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 100" width="100%" height="100%">
        <g>
          <path d="M 50 10 L 10 45 L 18 52 L 50 24 L 82 52 L 90 45 Z" fill="#171717" />
          <rect x="26" y="48" width="12" height="42" fill="#171717" />
          <rect x="62" y="48" width="12" height="42" fill="#171717" />
          <rect x="26" y="63" width="48" height="12" fill="#171717" />
        </g>

        <text x="120" y="54" font-family="system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif" font-size="44" font-weight="900" fill="#171717" letter-spacing="0.05em">HARDING</text>
        <text x="123" y="82" font-family="system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif" font-size="16" font-weight="400" fill="#525252" letter-spacing="0.45em">CONSTRUCTION</text>
      </svg>
    </a>

    <!-- Mobile Actions (Phone + Hamburger) -->
    <div class="flex items-center gap-2 xl:hidden">
      <a href={phoneClean} class="flex items-center gap-1.5 py-2 px-3 text-sm font-semibold bg-accent hover:bg-accent-hover transition-colors text-white rounded-md no-underline duration-200 active:scale-[0.98]" aria-label={`Call ${phoneFormatted}`}>
        <svg class="w-6 text-white" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M16.5562 12.9062L16.1007 13.359C16.1007 13.359 15.0181 14.4355 12.0631 11.4972C9.10812 8.55901 10.1907 7.48257 10.1907 7.48257L10.4775 7.19738C11.1841 6.49484 11.2507 5.36691 10.6342 4.54348L9.37326 2.85908C8.61028 1.83992 7.13596 1.70529 6.26145 2.57483L4.69185 4.13552C4.25823 4.56668 3.96765 5.12559 4.00289 5.74561C4.09304 7.33182 4.81071 10.7447 8.81536 14.7266C13.0621 18.9492 17.0468 19.117 18.6763 18.9651C19.1917 18.9171 19.6399 18.6546 20.0011 18.2954L21.4217 16.883C22.3806 15.9295 22.1102 14.2949 20.8833 13.628L18.9728 12.5894C18.1672 12.1515 17.1858 12.2801 16.5562 12.9062Z" fill="currentColor"></path> </g></svg>
        
        <span class="hidden sm:inline">{phoneFormatted}</span>
      </a>

      <button class="nav-toggle flex flex-col justify-center gap-1.25 w-11 h-11 p-2.5 bg-transparent border-none cursor-pointer [-webkit-tap-highlight-color:transparent]" id="nav-toggle" type="button" aria-expanded="false" aria-controls="nav-mobile-menu" aria-label="Open menu">
        <span class="nav-toggle-bar block w-6 h-0.5 bg-neutral-900 rounded-sm transition-all duration-300" aria-hidden="true"></span>
        <span class="nav-toggle-bar block w-6 h-0.5 bg-neutral-900 rounded-sm transition-all duration-300" aria-hidden="true"></span>
        <span class="nav-toggle-bar block w-6 h-0.5 bg-neutral-900 rounded-sm transition-all duration-300" aria-hidden="true"></span>
      </button>
    </div>

    <!-- Desktop Navigation -->
    <div class="hidden xl:flex xl:items-center" id="nav-menu">
      <ul class="flex items-center gap-8 list-none m-0 p-0">
        {
          NAV_LINKS.map((link) => (
            <li>
              <a href={link.href} class:list={[
                'relative text-[0.9375rem] font-medium no-underline py-2 transition-colors duration-200',
                'after:content-[""] after:absolute after:bottom-0 after:left-0 after:w-0 after:h-0.5 after:bg-neutral-900 after:transition-all after:duration-200',
                'hover:text-neutral-900 hover:after:w-full',
                currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href)) ? 'text-neutral-900 after:w-full' : 'text-neutral-500'
              ]}
              >
                {link.label}
              </a>
            </li>
          ))
        }
      </ul>

      <div class="flex items-center gap-3 ml-8">
        <a href={phoneClean} class="btn-outline">
          <svg class="w-4.5 h-4.5 shrink-0" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          {phoneFormatted}
        </a>

        <a href="/contact" class="btn-primary">
          Get a Free Quote
          
          <svg class="w-4.5 h-4.5 shrink-0 transition-transform duration-200 group-hover:translate-x-0.5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M5 12h14m-6-6 6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Overlay -->
  <div class="nav-overlay fixed inset-0 bg-black/50 opacity-0 invisible transition-all duration-300 z-98" id="nav-overlay"></div>

  <!-- Mobile Slide-out Menu -->
  <div class="nav-mobile-menu fixed top-0 right-0 bottom-0 w-75 max-w-[85vw] bg-white transition-transform duration-300 z-99 flex flex-col overflow-y-auto" id="nav-mobile-menu">
    <!-- Close Button Header -->
    <div class="flex items-center justify-end py-4 px-6 shrink-0">
      <button class="flex items-center justify-center w-11 h-11 -mr-2 bg-transparent border-none rounded-lg cursor-pointer text-neutral-500 transition-colors duration-200 hover:bg-neutral-100 hover:text-neutral-900 active:bg-neutral-200 [-webkit-tap-highlight-color:transparent]" id="nav-close" type="button" aria-label="Close menu">
        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <ul class="list-none m-0 py-2 px-0 flex-1">
      {
        NAV_LINKS.map((link) => (
        <li>
          
          <a href={link.href}
            class:list={[
              'block py-4 px-6 text-[1.0625rem] font-medium no-underline transition-colors duration-200 hover:bg-neutral-50 hover:text-neutral-900',
              currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href)) ? 'text-neutral-900 font-semibold bg-neutral-100' : 'text-neutral-500'
            ]}
          >
            {link.label}
          </a>
        </li>
        ))
      }
    </ul>

    <!-- Mobile Contact Options -->
    <div class="p-6 border-t border-neutral-200 flex flex-col gap-3 shrink-0">
      <a href={`tel:+1${phoneClean}`} class="flex items-center justify-center gap-2 w-full py-3.5 px-4 text-[0.9375rem] font-semibold bg-accent hover:bg-accent-hover transition-colors text-white rounded-lg no-underline duration-200 active:scale-[0.98]">
        <svg class="w-6 text-white" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M16.5562 12.9062L16.1007 13.359C16.1007 13.359 15.0181 14.4355 12.0631 11.4972C9.10812 8.55901 10.1907 7.48257 10.1907 7.48257L10.4775 7.19738C11.1841 6.49484 11.2507 5.36691 10.6342 4.54348L9.37326 2.85908C8.61028 1.83992 7.13596 1.70529 6.26145 2.57483L4.69185 4.13552C4.25823 4.56668 3.96765 5.12559 4.00289 5.74561C4.09304 7.33182 4.81071 10.7447 8.81536 14.7266C13.0621 18.9492 17.0468 19.117 18.6763 18.9651C19.1917 18.9171 19.6399 18.6546 20.0011 18.2954L21.4217 16.883C22.3806 15.9295 22.1102 14.2949 20.8833 13.628L18.9728 12.5894C18.1672 12.1515 17.1858 12.2801 16.5562 12.9062Z" fill="currentColor"></path> </g></svg>
        
        Call {phoneFormatted}
      </a>

      <a href="/contact" class="flex items-center justify-center gap-2 w-full py-3.5 px-4 text-[0.9375rem] font-semibold border text-neutral-700 border-neutral-300 rounded-lg no-underline transition-colors duration-200 hover:text-neutral-900 hover:border-neutral-400 hover:bg-neutral-50 active:scale-[0.98]">
        Get a Free Quote
        
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M5 12h14m-6-6 6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </a>
    </div>
  </div>
</nav>

<!-- Spacer for fixed nav -->
<div class="h-15 sm:h-16 lg:h-18"></div>

<style>
  /* Toggle animation */
  .nav-toggle.is-open .nav-toggle-bar:nth-child(1) {
    transform: translateY(7px) rotate(45deg);
  }

  .nav-toggle.is-open .nav-toggle-bar:nth-child(2) {
    opacity: 0;
  }

  .nav-toggle.is-open .nav-toggle-bar:nth-child(3) {
    transform: translateY(-7px) rotate(-45deg);
  }

  /* Overlay states */
  .nav-overlay.is-open {
    opacity: 1;
    visibility: visible;
  }

  /* Mobile menu - closed (default) */
  .nav-mobile-menu {
    transform: translateX(100%);
  }

  /* Mobile menu - open */
  .nav-mobile-menu.is-open {
    transform: translateX(0);
  }
</style>

<script>
  const toggle = document.getElementById('nav-toggle') as HTMLButtonElement | null;
  const closeBtn = document.getElementById('nav-close') as HTMLButtonElement | null;
  const mobileMenu = document.getElementById('nav-mobile-menu') as HTMLDivElement | null;
  const overlay = document.getElementById('nav-overlay') as HTMLDivElement | null;

  if (toggle && mobileMenu && overlay) {
    function openMenu(): void {
      toggle!.classList.add('is-open');
      toggle!.setAttribute('aria-expanded', 'true');
      toggle!.setAttribute('aria-label', 'Close menu');
      mobileMenu!.classList.add('is-open');
      overlay!.classList.add('is-open');
      document.body.style.overflow = 'hidden';

      if (closeBtn) closeBtn.focus();
    }

    function closeMenu(): void {
      toggle!.classList.remove('is-open');
      toggle!.setAttribute('aria-expanded', 'false');
      toggle!.setAttribute('aria-label', 'Open menu');
      mobileMenu!.classList.remove('is-open');
      overlay!.classList.remove('is-open');
      document.body.style.overflow = '';
    }

    toggle.addEventListener('click', () => {
      toggle.classList.contains('is-open') ? closeMenu() : openMenu();
    });

    if (closeBtn) {
      closeBtn.addEventListener('click', () => {
        closeMenu();
        toggle.focus();
      });
    }

    overlay.addEventListener('click', closeMenu);

    document.addEventListener('keydown', (e: KeyboardEvent) => {
      if (e.key === 'Escape' && mobileMenu.classList.contains('is-open')) {
        closeMenu();
        toggle.focus();
      }
    });

    window.matchMedia('(min-width: 1024px)').addEventListener('change', (e: MediaQueryListEvent) => {
      if (e.matches) closeMenu();
    });

    mobileMenu.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', closeMenu);
    });
  }
</script>